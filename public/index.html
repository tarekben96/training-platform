<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>مؤسسة التدريب — المنصة النهائية</title>

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

  <link href="css/style.css" rel="stylesheet">
</head>
<body>
  <!-- overlay for mobile sidebar -->
  <div id="sidebar-overlay" onclick="closeSidebar()" aria-hidden="true"></div>

  <!-- hamburger -->
  <button class="mobile-toggle" aria-label="فتح القائمة" onclick="openSidebar()">☰</button>

  <div class="container" role="application" aria-label="نظام المؤسسة">
    <!-- Sidebar -->
    <aside id="sidebar" class="sidebar" aria-label="القائمة الجانبية">
      <div class="brand">
        <span>مؤسسة التدريب — نهائي</span>
        <button style="background:transparent;border:0;cursor:pointer;font-size:18px" onclick="closeSidebar()" aria-label="إغلاق">✕</button>
      </div>

      <nav class="nav" role="navigation" aria-label="التنقل">
        <button id="tab-dashboard" class="active" onclick="onNavClick('dashboard', this)">لوحة القيادة</button>
        <button id="tab-courses" onclick="onNavClick('courses', this)">الدورات</button>
        <button id="tab-classroom" onclick="onNavClick('classroom', this)">الفصل المباشر</button>

        <div class="has-submenu" id="menu-assess">
          <button onclick="toggleSubmenu('menu-assess')">الاختبارات <span class="caret">▾</span></button>
          <ul class="submenu" aria-hidden="true">
            <li onclick="onNavClick('assessments', this)">قائمة الاختبارات</li>
            <li onclick="APP.openCreateTest && APP.openCreateTest()">إنشاء اختبار</li>
          </ul>
        </div>

        <button id="tab-crm" onclick="onNavClick('crm', this)">نظام المتدربين (CRM)</button>

        <div class="has-submenu" id="menu-settings">
          <button onclick="toggleSubmenu('menu-settings')">الإعدادات <span class="caret">▾</span></button>
          <ul class="submenu" aria-hidden="true">
            <li onclick="onNavClick('settings', this)">التكاملات</li>
            <li onclick="alert('حساب المستخدم')">الحساب</li>
          </ul>
        </div>
      </nav>

      <div style="margin-top:auto">
        <div class="note">النسخة النهائية — رفع للخادم مطلوب للتكامل الحقيقي</div>
      </div>
    </aside>

    <!-- Main -->
    <main class="main">
      <!-- Dashboard -->
      <section id="dashboard" class="tab">
        <div class="header-row">
          <div>
            <div class="title">لوحة القيادة</div>
            <div class="subtle">نظرة عامة على الأداء</div>
          </div>
          <div style="text-align:right">
            <div id="current-date" style="font-weight:800;font-size:16px"></div>
            <div class="subtle">مرحبا — مدير</div>
          </div>
        </div>

        <section class="metrics">
          <div class="card"><div class="metric-label">إجمالي المتدربين</div><div id="metric-students" class="metric-value">0</div></div>
          <div class="card"><div class="metric-label">الدورات</div><div id="metric-courses" class="metric-value">0</div></div>
          <div class="card"><div class="metric-label">جلسات مستقبلية</div><div id="metric-sessions" class="metric-value">0</div></div>
          <div class="card"><div class="metric-label">إجمالي العائد</div><div id="metric-revenue" class="metric-value">0 USD</div></div>
        </section>

        <section class="grid">
          <div class="card wide">
            <strong>نمو المتدربين</strong><small class="subtle">آخر 6 أشهر</small>
            <div class="chart-wrap" style="margin-top:8px"><canvas id="chartUsers"></canvas></div>
          </div>

          <div class="card">
            <strong>الجلسات بحسب الجهاز</strong><small class="subtle">نسبة</small>
            <div class="chart-wrap" style="height:200px;margin-top:8px"><canvas id="chartDevice"></canvas></div>
            <div style="display:flex;justify-content:space-between;margin-top:12px;color:#475569;font-weight:700">
              <div>دسكتوب <span id="device-desktop">60%</span></div>
              <div>موبايل <span id="device-mobile">30%</span></div>
              <div>تابلت <span id="device-tablet">10%</span></div>
            </div>
          </div>

          <div class="card">
            <strong>أحدث النشاط</strong><small class="subtle">آخر 10 سجلات</small>
            <ul id="recent-activity" style="padding:0;margin-top:8px"></ul>
          </div>
        </section>
      </section>

      <!-- Courses -->
      <section id="courses" class="tab" hidden>
        <div class="header-row">
          <div><div class="title">الدورات</div><div class="subtle">إنشاء وإدارة الدورات</div></div>
          <div><button class="btn-primary" onclick="APP.openCreateCourse()">إنشاء دورة</button></div>
        </div>
        <div id="courses-list" class="courses"></div>
      </section>

      <!-- Classroom -->
      <section id="classroom" class="tab" hidden>
        <div class="header-row">
          <div><div class="title">الفصل الافتراضي</div><div class="subtle">روابط الانضمام وجدولة الجلسات</div></div>
          <div><button class="btn-primary" onclick="APP.openScheduleSession()">جدولة جلسة</button></div>
        </div>
        <div class="card" style="margin-bottom:12px">
          <strong>جلسات قادمة</strong>
          <table id="sessions-table"><thead><tr><th>موضوع</th><th>تاريخ/وقت</th><th>دورة</th><th>إجراء</th></tr></thead><tbody></tbody></table>
        </div>
      </section>

      <!-- Assessments -->
      <section id="assessments" class="tab" hidden>
        <div class="header-row">
          <div><div class="title">الاختبارات</div><div class="subtle">إنشاء واختبار ومراقبة</div></div>
          <div><button class="btn-primary" onclick="APP.openCreateTest()">إنشاء اختبار</button></div>
        </div>
        <div id="tests-list"></div>
      </section>

      <!-- CRM -->
      <section id="crm" class="tab" hidden>
        <div class="header-row"><div><div class="title">نظام المتدربين (CRM)</div></div></div>
        <div class="card" style="margin-bottom:12px">
          <strong>إضافة متدرب</strong>
          <div style="margin-top:8px">
            <div class="row"><input id="crm-name" placeholder="الاسم الكامل" /><input id="crm-email" placeholder="البريد الإلكتروني" /></div>
            <div class="row" style="margin-top:8px"><input id="crm-phone" placeholder="الهاتف" /><select id="crm-source"><option value="website">الموقع</option><option value="ads">إعلان</option><option value="referral">إحالة</option></select></div>
            <div style="display:flex;gap:8px;margin-top:8px"><button class="btn-primary" onclick="APP.addLead()">إضافة</button><button class="btn-ghost" onclick="APP.exportLeadsCSV()">تصدير CSV</button></div>
          </div>
        </div>
        <div class="card"><strong>قائمة المتدربين</strong>
          <div class="table-wrapper" style="margin-top:10px"><table><thead><tr><th>الاسم</th><th>إيميل</th><th>هاتف</th><th>مصدر</th><th>إجراءات</th></tr></thead><tbody id="leads-table"></tbody></table></div>
        </div>
      </section>

      <!-- Settings -->
      <section id="settings" class="tab" hidden>
        <div class="header-row"><div><div class="title">الإعدادات</div><div class="subtle">تكاملات وإعدادات</div></div></div>
        <div class="card"><strong>التكاملات</strong><ul><li>BaridiMob / ECCP</li><li>Proctoring</li></ul></div>
      </section>
    </main>
  </div>

  <!-- Modal -->
  <div id="modal"><div id="modal-content"></div></div>

  <!-- Load Proctor first, then app, then payments -->
  <script src="js/proctor.js"></script>
  <script src="js/app.js"></script>
  <script src="js/payments.js"></script>
</body>
</html>
